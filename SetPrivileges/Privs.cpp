/* Marcus Botacin
 * Privilege elevation tool
 * I wrote this tool to ease the task of implementing
 * analysis procedures which
 * require admin's rights 
 */

#include<stdio.h>
#include<Windows.h>

void Privileges()
{
	BOOL ret;
	HANDLE Token;
	/* Locally unique identifier */
	LUID Luid = { NULL }; 
	TOKEN_PRIVILEGES Privs = { NULL };

	ret = OpenProcessToken(GetCurrentProcess(),TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &Token);
	if (!ret) 
	{
		printf("OpenProcessToken Error\n");
		exit(0);
	}

	if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &Luid) || (Luid.LowPart == NULL && Luid.HighPart == NULL))
	{
		printf("LUI Error\n");
		exit(0);
	}
	
	

	Privs.PrivilegeCount = 1;
	Privs.Privileges[0].Luid = Luid;
	Privs.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;

	if (!AdjustTokenPrivileges(Token, FALSE, &Privs,sizeof (Privs), NULL, NULL)){
		printf("AdjustTokenPrivileges Error\n");
		exit(0);
	}

	printf("Privileges Set\n");

}

int main()
{
	Privileges();
	printf("Analysis Starts Here...\n");
	/* Put your analysis code here */
}